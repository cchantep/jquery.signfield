!function(e){"use strict";var a=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},r=function(e){var a="object"!=typeof signField_I18N?null:signField_I18N[e];return a||"?"+e+"?"};e.fn.signField=function(t){var n=e(this);if("errors"==t){var i=[];return n.each(function(a,r){var t=e(r);if("yes"!=t.data("signature"))return!0;var n=t.data("errors");return""==e.trim(n)?!0:void(i=i.concat(n))}),i}var c=[];return n.each(function(t,n){var i=e(n),s=i.attr("id"),l=i.data("name"),o=i.attr("class"),d=e('<div class="'+o+'" id="'+s+'" data-signature="yes"></div>').attr("data-name",l),u=a()?e("<canvas></canvas>").appendTo(d):null,f=e('<input type="file" name="'+l+'-file" />').appendTo(d),p=f.get(0),v=e('<span class="message"></span>').appendTo(d),h=function(){return!0};if(p.files)try{var g=parseInt(i.data("max-size"));h=function(){var a=0==p.files.length?0:p.files[0].size/1024;if(a>g){var t=d.data("errors");d.addClass("has-error"),v.text(r("file.error.maxSize").replace("{0}",a).replace("{1}",g)),""!=e.trim(t)?d.data("errors",t+",file.error.maxSize"):d.data("errors","file.error.maxSize")}else d.removeClass("has-error"),v.text("")}}catch(i){}if(u){var m=i.data("pen-tickness")||2,k=e('<input type="hidden" value="" />').appendTo(d),y=u.get(0),b=function(){k.attr("name",l).attr("value",y.toDataURL()),f.removeAttr("name");var a="";e.each(d.data("errors").split(","),function(r,t){return t&&t.length>11&&"file.error."==t.substring(0,11)?!0:void(""!=e.trim(t)&&(a+=t))}),d.data("errors",a),""==a&&d.removeClass("has-error")},x=function(){k.removeAttr("name"),f.attr("name",l),h()},C=e('<input type="radio" name="'+l+'-type" value="canvas" />').change(b),z=e('<input type="radio" name="'+l+'-type" value="file" />'),S=u.width(),T=u.height();z.change(function(){return""==e.trim(f.val())?(z.removeAttr("checked"),!1):void x()}),S&&u.attr("width",S),T&&u.attr("height",T),u.sketch({defaultColor:i.data("pen-color")||i.css("color")||"black",defaultSize:m}).on("mouseup click",function(){C.trigger("click"),d.trigger("change")}),e('<label class="radio sketch-radio">'+r("sketch.label")+"</label>").prepend(C).insertBefore(u),e('<a href="#clear" class="clear-canvas">'+r("sketch.clear")+"</a>").insertBefore(u).click(function(){return y.getContext("2d").clearRect(0,0,S,T),u.sketch("actions",[]),!1}),e('<label class="radio file-radio">'+r("file.label")+"</label>").prepend(z).insertBefore(f),f.change(function(){z.trigger("click")})}else f.attr("name",l);f.change(function(){h(),d.trigger("change")}),i.replaceWith(d),c.push(d.get(0))}),e(c)}}(jQuery);
